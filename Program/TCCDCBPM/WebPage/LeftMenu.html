<div id="sidebar-wrapper" class="bg-white">
    <div class="metismenubox" id="promenu">
        <nav class="sidebarmenu">
            <ul>
                <li>
                    <div class="menuitemwrapper">
                        <div class="flex-fill">
                            <a href="#" data-bs-toggle="modal" data-bs-target="#handlebox">公文儀表板</a>
                        </div>
                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                    </div>
                </li>
                <li>
                    <div class="menuitemwrapper">
                        <div class="flex-fill">
                            <a href="https://www.google.com/" target="_blank">我的公文匣</a>
                        </div>
                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                    </div>
                    <ul class="submenu">
                        <li>
                            <div class="menuitemwrapper">
                                <div class="flex-fill">
                                    <a href="DocPendingProcessing.aspx" target="_self">待處理公文</a>
                                </div>
                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                            </div>
                        </li>
                        <li>
                            <div class="menuitemwrapper">
                                <div class="flex-fill">
                                    <a href="https://www.google.com/" target="_blank">代理人公文</a>
                                </div>
                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                            </div>
                        </li>
                    </ul>
                </li>
                <li>
                    <div class="menuitemwrapper">
                        <div class="flex-fill">
                            <a href="https://www.google.com/" target="_blank">公文製作</a>
                        </div>
                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                    </div>
                    <ul class="submenu">
                        <li>
                            <div class="menuitemwrapper">
                                <div class="flex-fill">
                                    <a href="DocFieldManage.aspx" target="_self">行管部</a>
                                </div>
                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                            </div>
                            <ul class="submenu">
                                <li>
                                    <div class="menuitemwrapper">
                                        <div class="flex-fill">
                                            <a href="DocManage.aspx" target="_self">HR</a>
                                        </div>
                                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                    </div>
                                    <ul class="submenu">
                                        <li>
                                            <div class="menuitemwrapper">
                                                <div class="flex-fill">
                                                    <a href="DocManage.aspx" target="_self">教育訓練</a>
                                                </div>
                                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                            </div>
                                            <ul name="ul_name_D5DB89CA-5A93-4312-A184-A4B922698CA6" class="submenu"></ul>
                                        </li>
                                        <li>
                                            <div class="menuitemwrapper">
                                                <div class="flex-fill">
                                                    <a href="DocManage.aspx" target="_self">人力資源</a>
                                                </div>
                                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                            </div>
                                            <ul name="ul_name_BF950419-E933-4F0E-B1FD-77CCF3012014" class="submenu"></ul>
                                        </li>
                                        <li>
                                            <div class="menuitemwrapper">
                                                <div class="flex-fill">
                                                    <a href="DocManage.aspx" target="_self">其他</a>
                                                </div>
                                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                            </div>
                                            <ul name="ul_name_31942163-C7A6-4335-BF9C-D17BEA2B1336" class="submenu"></ul>
                                        </li>
                                    </ul>
                                </li>
                                <li>
                                    <div class="menuitemwrapper">
                                        <div class="flex-fill">
                                            <a href="DocManage.aspx" target="_self">IT</a>
                                        </div>
                                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                    </div>
                                </li>
                                <li>
                                    <div class="menuitemwrapper">
                                        <div class="flex-fill">
                                            <a href="DocManage.aspx" target="_self">總務</a>
                                        </div>
                                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                    </div>
                                    <ul class="submenu">
                                        <li>
                                            <div class="menuitemwrapper">
                                                <div class="flex-fill">
                                                    <a href="DocManage.aspx" target="_self">表單資料</a>
                                                </div>
                                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                            </div>
                                            <ul name="ul_name_3C982DB4-355C-4C6F-83DB-B83F96A8E7C2" class="submenu"></ul>
                                        </li>
                                        <li>
                                            <div class="menuitemwrapper">
                                                <div class="flex-fill">
                                                    <a href="DocManage.aspx" target="_self">線上系統現有單據</a>
                                                </div>
                                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                            </div>
                                            <ul name="ul_name_22E8E5BA-4C8A-4753-9914-EA63621F4862" class="submenu"></ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <div class="menuitemwrapper">
                                <div class="flex-fill">
                                    <a href="DocFieldManage.aspx" target="_self">法務室</a>
                                </div>
                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                            </div>
                        </li>
                        <li>
                            <div class="menuitemwrapper">
                                <div class="flex-fill">
                                    <a href="DocFieldManage.aspx" target="_self">星元</a>
                                </div>
                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                            </div>
                        </li>
                        <li>
                            <div class="menuitemwrapper">
                                <div class="flex-fill">
                                    <a href="DocFieldManage.aspx" target="_self">星能</a>
                                </div>
                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                            </div>
                            <ul class="submenu">
                                <li>
                                    <div class="menuitemwrapper">
                                        <div class="flex-fill">
                                            <a href="DocManage.aspx" target="_self">教育訓練</a>
                                        </div>
                                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                    </div>
                                    <ul name="ul_name_40CF9521-A8F5-482E-988D-ABFD98AA17AA" class="submenu"></ul>
                                </li>
                                <li>
                                    <div class="menuitemwrapper">
                                        <div class="flex-fill">
                                            <a href="DocManage.aspx" target="_self">資訊類</a>
                                        </div>
                                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                    </div>
                                    <ul name="ul_name_0B54223E-633C-4F19-9EFC-5EE04BAB87B4" class="submenu"></ul>
                                </li>
                                <li>
                                    <div class="menuitemwrapper">
                                        <div class="flex-fill">
                                            <a href="DocManage.aspx" target="_self">總務</a>
                                        </div>
                                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                    </div>
                                    <ul name="ul_name_973B6798-C450-494B-B7CA-3B4BF7B72242" class="submenu"></ul>
                                </li>
                                <li>
                                    <div class="menuitemwrapper">
                                        <div class="flex-fill">
                                            <a href="DocManage.aspx" target="_self">其他</a>
                                        </div>
                                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                    </div>
                                    <ul name="ul_name_B8313F34-4215-42E3-B2FD-6B4D49873BF3" class="submenu"></ul>
                                </li>
                                <li>
                                    <div class="menuitemwrapper">
                                        <div class="flex-fill">
                                            <a href="DocManage.aspx" target="_self">人力資源</a>
                                        </div>
                                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                    </div>
                                    <ul class="submenu">
                                        <li>
                                            <div class="menuitemwrapper">
                                                <div class="flex-fill">
                                                    <a href="DocManage.aspx" target="_self">招募任用</a>
                                                </div>
                                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                            </div>
                                            <ul name="ul_name_CEF2EE1B-C418-45BC-84BD-5B52C8F8BB2E" class="submenu"></ul>
                                        </li>
                                        <li>
                                            <div class="menuitemwrapper">
                                                <div class="flex-fill">
                                                    <a href="DocManage.aspx" target="_self">員工關係</a>
                                                </div>
                                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                            </div>
                                            <ul name="ul_name_1BBCD047-DEAD-4AAB-BDDA-59CC8D84E89C" class="submenu"></ul>
                                        </li>
                                        <li>
                                            <div class="menuitemwrapper">
                                                <div class="flex-fill">
                                                    <a href="DocManage.aspx" target="_self">績效考核</a>
                                                </div>
                                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                            </div>
                                            <ul name="ul_name_92FCE686-AFF9-4AF0-96EB-DE4A1E5E661C" class="submenu"></ul>
                                        </li>
                                        <li>
                                            <div class="menuitemwrapper">
                                                <div class="flex-fill">
                                                    <a href="DocManage.aspx" target="_self">薪酬福利</a>
                                                </div>
                                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                                            </div>
                                            <ul name="ul_name_EA254A6E-2589-4CB0-899B-671D1B17ABB5" class="submenu"></ul>
                                        </li>
                                    </ul>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <div class="menuitemwrapper">
                                <div class="flex-fill">
                                    <a href="DocFieldManage.aspx" target="_self">財務部</a>
                                </div>
                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                            </div>
                        </li>
                    </ul>
                </li>
                <li>
                    <div class="menuitemwrapper">
                        <div class="flex-fill">
                            <a href="https://www.google.com/" target="_blank">公文管理</a>
                        </div>
                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                    </div>
                    <ul class="submenu">
                        <li>
                            <div class="menuitemwrapper">
                                <div class="flex-fill">
                                    <a href="DocManage.aspx" target="_self">公文範本管理</a>
                                </div>
                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                            </div>
                        </li>
                        <li>
                            <div class="menuitemwrapper">
                                <div class="flex-fill">
                                    <a href="DocFieldManage.aspx" target="_self">公文範本欄位管理</a>
                                </div>
                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                            </div>
                        </li>
                        <li>
                            <div class="menuitemwrapper">
                                <div class="flex-fill">
                                    <a href="DocSearch.aspx" target="_self">公文查詢</a>
                                </div>
                                <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                            </div>
                        </li>
                    </ul>
                </li>
            </ul>
        </nav>
    </div><!-- metismenubox -->



</div><!-- sidebar-wrapper -->
<input id="input_LeftMenuParentFileGuid" type="hidden" />
<input id="input_LeftMenuFileSn" type="hidden" />
<input id="input_LeftMenuFileName" type="hidden" />
<!-- Magnific Popup -->
<div id="mp_LeftMenuPop" class="magpopup magSizeM mfp-hide">
    <div class="magpopupTitle"><span id="mp_LeftMenuFileName"></span></div>
    <div class="padding10ALL">
        <div class="ochiform TitleLength05">
            <div class="row gy-2 mt-1 align-items-center OchiRow">
                <div class="col-md-6">
                    <!-- form item start -->
                    <div class="row flex-md-nowrap align-items-center">
                        <div class="col-md-auto TitleSetWidth text-md-end"><label class="form-label" for="lokiMail">主旨</label></div>
                        <div class="col-md-auto flex-grow-1">
                            <input id="txt_LeftMenuTitle" class="form-control" type="text" placeholder="請輸入主旨">
                        </div>
                    </div><!-- row -->
                    <!-- form item end -->
                </div><!-- col -->
                <div class="col-md-6">
                    <!-- form item start -->
                    <div class="row flex-md-nowrap align-items-center">
                        <div class="col-md-auto TitleSetWidth text-md-end"><label class="form-label" for="Name">公文</label></div>
                        <div class="col-md-auto flex-grow-1">
                            <a id="a_LeftMenuFileView" href="javascript:void(0);" class="btn btn-outline-success">預覽</a>
                        </div>
                    </div><!-- row -->
                    <!-- form item end -->
                </div><!-- col -->
            </div><!-- row -->
        </div>

        <div class="d-flex align-items-center justify-content-between my-2">
            <div class=""></div>
            <div>
                <a id="a_LeftMenuCancelBtn" href="javascript:void(0);" class="btn btn-outline-dark me-1 closecolorbox">取消</a>
                <a id="a_LeftMenuSaveBtn" href="javascript:void(0);" class="btn btn-primary me-1">儲存</a>
            </div>
        </div>
    </div>
        <!-- padding10ALL -->
    </div>
<!--magpopup -->

<script type="text/javascript">
    $(document).ready(function () {
        getFileMenu('D5DB89CA-5A93-4312-A184-A4B922698CA6');
        getFileMenu('BF950419-E933-4F0E-B1FD-77CCF3012014');
        getFileMenu('31942163-C7A6-4335-BF9C-D17BEA2B1336');
        getFileMenu('3C982DB4-355C-4C6F-83DB-B83F96A8E7C2');
        getFileMenu('22E8E5BA-4C8A-4753-9914-EA63621F4862');
        getFileMenu('40CF9521-A8F5-482E-988D-ABFD98AA17AA');
        getFileMenu('0B54223E-633C-4F19-9EFC-5EE04BAB87B4');
        getFileMenu('973B6798-C450-494B-B7CA-3B4BF7B72242');
        getFileMenu('B8313F34-4215-42E3-B2FD-6B4D49873BF3');
        getFileMenu('CEF2EE1B-C418-45BC-84BD-5B52C8F8BB2E');
        getFileMenu('1BBCD047-DEAD-4AAB-BDDA-59CC8D84E89C');
        getFileMenu('92FCE686-AFF9-4AF0-96EB-DE4A1E5E661C');
        getFileMenu('EA254A6E-2589-4CB0-899B-671D1B17ABB5');

        //開啟公文彈出視窗
        $(document).on("click", "a[name='a_LeftMenuFile']", function () {
            $("#input_LeftMenuParentFileGuid").val($(this).attr("aparentfileguid"));
            $("#input_LeftMenuFileSn").val($(this).attr("asn"));
            $("#input_LeftMenuFileName").val($(this).attr("afilename"));
            $("#mp_LeftMenuFileName").html($("#input_LeftMenuFileName").val());
            doOpenMagLeftMenuPopup('mp_LeftMenuPop');
        });

        //取消視窗
        $(document).on("click", "#a_LeftMenuCancelBtn", function () {
            $.magnificPopup.close();
        });

        //新增公文
        $(document).on("click", "#a_LeftMenuSaveBtn", function () {
            var parentGuid = $("#input_LeftMenuParentFileGuid").val();
            var sn = $("#input_LeftMenuFileSn").val();
            var title = $("#txt_LeftMenuTitle").val();

            if (confirm("確定開啟此公文嗎?")) {
                $.ajax({
                    type: "POST",
                    async: false, //在沒有返回值之前,不會執行下一步動作
                    url: "../handler/Doc_handler.aspx",
                    data: {
                        parentGuid: parentGuid,
                        sn: sn,
                        title: title,
                        crud: "new",
                    },
                    error: function (xhr) {
                        alert("Error: " + xhr.status);
                        console.log(xhr.responseText);
                    },
                    success: function (data) {
                        if ($(data).find("Error").length > 0) {
                            alert($(data).find("Error").attr("Message"));
                        }
                        else {
                            location.href = 'DocManageAdd.aspx?filetype=new&mode=fillForms&guid='
                                + $("guid", data).text() + '&parentGuid=' + parentGuid + '&sn=' + sn;
                        }
                    }
                });
            }
        });

        //預覽公文
        $(document).on("click", "#a_LeftMenuFileView", function () {
            var parentfileguid = $("#input_LeftMenuParentFileGuid").val();
            var filesn = $("#input_LeftMenuFileSn").val();
            var url = 'DocManageAdd.aspx?filetype=demo&mode=view&parentGuid=' + parentfileguid + '&sn=' + filesn;
            window.open(url, '_blank');
        });

        //儲存公文

        //getDocMenu();
    });

    function getFileMenu(parentguid) {
        $.ajax({
            type: "POST",
            async: false, //在沒有返回值之前,不會執行下一步動作
            url: "../handler/file_handler.aspx",
            data: {
                crud: "rf",
                parentguid: parentguid
            },
            error: function (xhr) {
                alert("Error: " + xhr.status);
                console.log(xhr.responseText);
            },
            success: function (data) {
                if ($(data).find("Error").length > 0) {
                    alert($(data).find("Error").attr("Message"));
                }
                else {
                    var publicParentFileGuid = ''
                    var ulstr = '';
                    if ($(data).find("data_item").length > 0) {
                        $(data).find("data_item").each(function (i) {
                            var parentfileguid = $(this).children("父層guid").text().trim();
                            var filesn = $(this).children("排序").text().trim();
                            var filename = $(this).children("原檔名").text().trim();
                            var docname = $(this).children("表單名稱").text().trim();
                            ulstr += '<li><div class="menuitemwrapper"> <div class="flex-fill"><a name="a_LeftMenuFile" href="javascript:void(0);"'
                                + ' aparentfileguid="' + parentfileguid + '" asn="' + filesn + '" afilename="' + filename + '">' + docname + '</a>';
                            ulstr += '</div></li>';
                            publicParentFileGuid = $(this).children("父層guid").text().trim();
                        });
                    }
                    $("ul[name='ul_name_" + publicParentFileGuid + "']").append(ulstr);
                }
            }
        });
    }


    function getDocMenu() {
        $.ajax({
            type: "POST",
            async: false,
            url: "../handler/DocMange_handler.aspx",
            data: { crud: "rm", rank: "1" }, // 撈第一層
            success: function (data) {

                let html = '<ul class="submenu">';

                $(data).find("data_item").each(function () {
                    let name = $(this).children("類別名稱").text().trim();
                    let guid = $(this).children("guid").text().trim();

                    html += `
                <li>
                    <div class="menuitemwrapper">
                        <div class="flex-fill"><a href="#" target="_self">${name}</a></div>
                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                    </div>
                    <ul class="submenu">
                        ${loadLevel2(guid)}
                    </ul>
                </li>`;
                });

                html += "</ul>";

                $("#ul_docMenu").html(html);
            }
        });
    }

    function loadLevel2(parentGuid) {
        let html = "";

        $.ajax({
            type: "POST",
            async: false,
            url: "../handler/DocMange_handler.aspx",
            data: { crud: "rm", parentguid: parentGuid },
            success: function (data) {

                $(data).find("data_item").each(function () {

                    let name = $(this).children("類別名稱").text().trim();
                    let guid = $(this).children("guid").text().trim();

                    html += `
                <li>
                    <div class="menuitemwrapper">
                        <div class="flex-fill"><a href="#" target="_self">${name}</a></div>
                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                    </div>
                    <ul class="submenu">
                        ${loadLevel3(guid)}
                    </ul>
                </li>`;
                });

            }
        });

        return html;
    }

    function loadLevel3(parentGuid) {
        let html = "";

        $.ajax({
            type: "POST",
            async: false,
            url: "../handler/DocMange_handler.aspx",
            data: { crud: "rm", parentguid: parentGuid },
            success: function (data) {

                $(data).find("data_item").each(function () {
                    let name = $(this).children("類別名稱").text().trim();
                    let guid = $(this).children("guid").text().trim();

                    html += `
                <li>
                    <div class="menuitemwrapper">
                        <div class="flex-fill">
                            <a href="DocManage.aspx?fguid=${guid}" target="_self">${name}</a>
                        </div>
                        <div class="text-nowrap"><span class="icon"><i class="fa-solid fa-chevron-right"></i></span></div>
                    </div>
                </li>`;
                });
            }
        });

        return html;
    }

    function doOpenMagLeftMenuPopup(id) {
        $.magnificPopup.open({
            items: {
                src: '#' + id
            },
            type: 'inline',
            midClick: false, // 是否使用滑鼠中鍵
            closeOnBgClick: true,//點擊背景關閉視窗
            showCloseBtn: true,//隱藏關閉按鈕
            fixedContentPos: true,//彈出視窗是否固定在畫面上
            mainClass: 'mfp-fade',//加入CSS淡入淡出效果
            tClose: '關閉',//翻譯字串
        });
    }

</script>